# Опрос Бот

## Описание проекта

Telegram-бот для проведения опросов.

## Структура проекта

```
├── .gitignore
├── alembic.ini
├── main.py
├── requirements.txt
├── alembic/
├── database/
├── docs/
├── handlers/
├── keyboards/
├── middleware/
├── states/
├── tests/
├── utils/
```

*   `.gitignore`: Файл, содержащий список файлов и директорий, которые не нужно отслеживать в Git.
*   `alembic.ini`: Файл конфигурации Alembic для управления миграциями базы данных.
*   `main.py`: Основной файл, запускающий бота.
*   `requirements.txt`: Файл, содержащий список зависимостей проекта.
*   `alembic/`: Директория, содержащая файлы миграций базы данных.
*   `database/`: Директория, содержащая файлы для работы с базой данных.
*   `docs/`: Директория, содержащая документацию проекта.
*   `handlers/`: Директория, содержащая обработчики команд и callback-запросов.
*   `keyboards/`: Директория, содержащая определения клавиатур для бота.
*   `middleware/`: Директория, содержащая middleware для обработки запросов.
*   `states/`: Директория, содержащая определения состояний FSM.
*   `tests/`: Директория, содержащая тесты проекта.
*   `utils/`: Директория, содержащая утилиты.

## Основные модули

*   `handlers/`: Содержит обработчики команд и callback-запросов.
    *   `admin.py`: Обработка административных команд (создание, запуск, завершение опросов, управление администраторами).
    *   `common.py`: Обработка общих команд (старт, помощь).
    *   `poll.py`: Обработка логики прохождения опросов пользователями.
*   `utils/`: Содержит утилиты.
    *   `poll_parser.py`: Утилита для парсинга файлов с вопросами.
    *   `report_generator.py`: Утилита для генерации отчетов в формате Excel.
*   `database/`: Содержит файлы для работы с базой данных.
    *   `database.py`: Функции для взаимодействия с базой данных (CRUD операции).
    *   `models.py`: Определение моделей базы данных (User, Poll, Question, PollResponse, QuestionResponse).
*   `states/`: Содержит определения состояний FSM.
    *   `admin_states.py`: Состояния для административных команд.
    *   `poll_states.py`: Состояния для создания и прохождения опросов.
    *   `user_states.py`: Состояния для регистрации пользователей.
*   `keyboards/`: Содержит определения клавиатур для бота.
*   `middleware/`: Содержит middleware для обработки запросов к базе данных.

## Модели базы данных

*   `User`: Модель пользователя.
*   `Poll`: Модель опроса.
*   `Question`: Модель вопроса.
*   `PollResponse`: Модель ответа на опрос.
*   `QuestionResponse`: Модель ответа на вопрос.

## FSM состояния

*   `AdminStates`: Состояния для административных команд.
*   `CreatePollStates`: Состояния для создания опросов.
*   `PollPassing`: Состояния для прохождения опросов.
*   `UserRegistration`: Состояния для регистрации пользователей.

## Развертывание и запуск

1.  Клонируйте репозиторий.
2.  Создайте виртуальное окружение: `python -m venv venv`
3.  Активируйте виртуальное окружение: `source venv/bin/activate` (Linux/macOS) или `venv\Scripts\activate` (Windows)
4.  Установите зависимости: `pip install -r requirements.txt`
5.  Создайте файл `.env` и добавьте в него токен бота: `BOT_TOKEN=<your_bot_token>`
6.  Запустите бота: `python main.py`

## Добавление новых функций

1.  Создайте новый файл в соответствующей директории (например, `handlers/new_handler.py`).
2.  Определите обработчики команд и callback-запросов.
3.  Добавьте новый роутер в `main.py`.
4.  Если требуется хранить состояния, определите новые состояния в соответствующем файле в директории `states/`.
    *   Импортируйте `State` и `StatesGroup` из `aiogram.fsm.state`.
    *   Создайте класс, наследующийся от `StatesGroup`.
    *   Определите состояния как переменные класса, используя `State()`.
    *   Используйте `FSMContext` для управления состояниями в обработчиках.

## Тестирование

Для запуска тестов необходимо:

1.  Установить pytest: `pip install pytest`
2.  Запустить тесты: `pytest`

В директории `tests/` находятся тесты для различных модулей проекта.
